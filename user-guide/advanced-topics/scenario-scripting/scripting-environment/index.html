<!DOCTYPE html>
<html lang="en-US">
<head>
  <script src="https://docs.nosqlbench.io/theme.min.js" integrity="sha384-IpIaa84kOKgkF5EJ0fD/kBe2wtIIsIB60ANGmuJxeA0dz5bSRfwBwp2/QybtQpU2"></script>
  <link rel="stylesheet" href="https://docs.nosqlbench.io/abridge-switcher.css?h=4238d999f44a7bb130d5" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="preload" as="style" class="preStyle" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" crossorigin="anonymous" />
  <script defer src="https://docs.nosqlbench.io/search_index.en.js?h=ae47d253e455a3aaacb2" integrity="sha384-cP47owL9Iuak1e1AA21cJA4BgagQtaPwAXBQG7QgJeE2JKGgkCBROHbCj/Xym6KC"></script>
  <script defer src="https://docs.nosqlbench.io/abridge-bundle-nofacade.min.js?h=9bcf621a2fcab7336017" integrity="sha384-u8AROOUG6n2Xjk2+7pvkkfeSIqinjI1tmqeBpZRlZtc5KFO/8DyFfEir6fAE2wcq"></script>
  <meta name="base" content="https://docs.nosqlbench.io" />
<meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>Scripting Environment | NoSQLBench Project</title>
  <meta name="copyright" content="NoSQLBench Project" />
  <meta name="description" content="NoSQLBench is an Open Source, Multi-Protocol, Pluggable, Scriptable, NoSQL (and more) Testing System." />
  <link rel="canonical" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/" />
  <meta name="keywords" content="Abridge, Abridge.css, Zola, Theme, Zola Theme, getzola, Semantic Html, Fast, lightweight" />
  <meta property="og:url" content="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/" />
  <meta name="twitter:url" content="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/" />
  <meta property="og:description" content="NoSQLBench is an Open Source, Multi-Protocol, Pluggable, Scriptable, NoSQL (and more) Testing System." />
  <meta name="twitter:description" content="NoSQLBench is an Open Source, Multi-Protocol, Pluggable, Scriptable, NoSQL (and more) Testing System." />
  <meta property="og:title" content="Scripting Environment | NoSQLBench Project" />
  <meta name="twitter:title" content="Scripting Environment | NoSQLBench Project" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://docs.nosqlbench.io/nb5banner.png" />
  <meta property="og:image" content="https://docs.nosqlbench.io/nb5banner.png" />
  <meta property="og:site_name" content="NoSQLBench Project" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <meta name="msapplication-TileColor" content="#333333" />
  <link rel="manifest" href="https://docs.nosqlbench.io/site.webmanifest" />
  <link rel="mask-icon" href="https://docs.nosqlbench.io/safari-pinned-tab.svg" color="#ff9900" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://docs.nosqlbench.io/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://docs.nosqlbench.io/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://docs.nosqlbench.io/favicon-16x16.png" />
  <noscript><link rel="stylesheet" href="https://docs.nosqlbench.io/nojs.css" /></noscript>
</head>
<body>
  <header>
    <nav>
      <div><h1><a href="https://docs.nosqlbench.io/"><img src="https://docs.nosqlbench.io/nb5logo.png" alt="NoSQLBench5" width="32" height="32" />NoSQLBench v5</a></h1></div><div>
        <ul><li> <h2><a href="https://docs.nosqlbench.io/getting-started/">Getting Started</a></h2> </li><li> <h2><a href="https://docs.nosqlbench.io/release-notes/">Release Notes</a></h2> </li><li class="js"><i type="reset" id="mode" class="svgs adjust"></i></li></ul>
      </div>
      <div>
        <form autocomplete=off class="js" name="goSearch" id="searchbox">
          <div class="searchd">
            <input id="searchinput" type="text" placeholder="Search" title="Search" />
            <button type="submit" title="Search"><i class="svgs search"></i></button>
          </div>
          <div><div id="suggestions"></div></div>
        </form>
      </div>

      <a href="http://github.com/nosqlbench/nosqlbench-build-docs" title="This doc site's project repo">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 22 18"
             fill="none"
             stroke="currentColor" stroke-width="1" stroke-linecap="round"
             stroke-linejoin="round">
          <path
              d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
        </svg>
      </a>
      <a href="http://nosqlbench.io" title="NoSQLBench Project Site">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 22 18"
             fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round"
             stroke-linejoin="round">
          <path
              d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
        </svg>
      </a>
    </nav>
    <hr /><div style="position:sticky"><span><a href="&#x2F;">NB5 Docsâ–º </a></span><span><a href="&#x2F;user-guide&#x2F;">User Guideâ–º </a></span><span><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;">Advanced Topicsâ–º </a></span><span title="NoSQLBench comes with a fully scriptable runtime for advanced testing scenarios"><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;"><strong>Scenario Scriptingâ–¼</strong> </a></span><span title="[current page]"><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-environment&#x2F;"><strong>Scripting Environment ðŸ–º</strong></a></span>
</div></header>
  <main><!-- active_page: user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-environment.md -->
<!-- active_section: user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;_index.md -->


<!-- lower_root: user-guide&#x2F;advanced-topics&#x2F;_index.md -->
<!-- >upper_root: user-guide&#x2F;advanced-topics&#x2F;_index.md -->

<div class="toc" aria-hidden="true" id="">
<!--  <h4>Scenario Scripting</h4>--><div class="toc-sticky"><div class="toc-item"><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;binding-concepts&#x2F;">Binding Concepts</a></div><div class="toc-item"><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;advanced-topics&#x2F;"title="detailed explanation of all available configuration methods in nb5">Advanced Topics</a></div><div class="toc-item"><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;timing-terms&#x2F;">Timing Terms Explained</a></div><div class="toc-item"title="Detailed examples of different ways to configure nb5"><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;configuration_techniques&#x2F;">â–ºConfiguration Techniques</a></div><div class="toc-item"title="NoSQLBench comes with a fully scriptable runtime for advanced testing scenarios"><strong>â–¼Scenario Scripting</strong></div><!-- subsection_page_path: &#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-intro&#x2F; -->
    <div class="toc-item-child">
      <a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-intro&#x2F;">Scripting Intro</a>
    </div><!-- subsection_page_path: &#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-parameters&#x2F; -->
    <div class="toc-item-child">
      <a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-parameters&#x2F;">Scripting Parameters</a>
    </div><!-- subsection_page_path: &#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-environment&#x2F; -->
    <div class="toc-item-child">
      <a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-environment&#x2F;"><strong>Scripting Environment</strong></a>
    </div><!-- subsection_page_path: &#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-extensions&#x2F; -->
    <div class="toc-item-child">
      <a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;scenario-scripting&#x2F;scripting-extensions&#x2F;">Scripting Extensions</a>
    </div><div class="toc-item"title="A deeper dive into frequent topics of discussion around scale testing."><a href="&#x2F;user-guide&#x2F;advanced-topics&#x2F;testing-at-scale&#x2F;">â–ºTesting at Scale</a></div></div>
</div>

<article>

  <p>NoSQLBench may look like a simplistic runtime for the casual user. This is quite intentional. Yet, a
serious amount of expressive power lies just below the surface for the adventuring tester.</p>
<h2 id="dynamic-parameters">Dynamic Parameters</h2>
<p>Dynamic parameters are control variables which, when assigned to, cause an immediate change in the
behavior of the runtime. Driver implementors have the option to make changes to activity
parameters reactive within the driver. These parameters are thus able to respond to direct
changes from within the scenario script. Additionally, some core parameters are dynamic.</p>
<h2 id="global-variables">Global Variables</h2>
<h4 id="scenario">scenario</h4>
<p>This is the <strong>Scenario Controller</strong> object which manages the activity executors in the runtime. All
the methods on this Java type are provided to the scripting environment directly.</p>
<h3 id="activity-parameters">Activity Parameters</h3>
<h4 id="activities-alias-paramname">activities.&lt;alias&gt;.&lt;paramname&gt;</h4>
<p>Each activity parameter for a given activity alias is available at this name within the scripting
environment. Thus, you can change the number of threads on an activity named foo (alias=foo) in the
scripting environment by assigning a value to it as in <code>activities.foo.threads=3</code>. Any assignments
take effect synchronously before the next line of the script continues executing.</p>
<h4 id="metrics-alias-metric-name"><strong>metrics</strong>.&lt;alias&gt;.&lt;metric name&gt;</h4>
<p>Each activity metric for a given activity alias is available at this name. This gives you access to
the metrics objects directly. Some metrics objects have also been enhanced with wrapper logic to
provide simple getters and setters, like
<code>.p99ms</code> or <code>.p99ns</code>, for example.</p>
<p>Interaction with the NoSQLBench runtime and the activities therein is made easy by the above
variables and objects. When an assignment is made to any of these variables, the changes are
propagated to internal listeners. For changes to
<em>threads</em>, the thread pool responsible for the affected activity adjusts the number of active
threads (AKA slots). Other changes are further propagated directly to the thread harnesses and
components which implement the ActivityType.</p>
<p><strong>WARNING:</strong>
Assignment to the <em>workload</em> and <em>alias</em> activity parameters has no special effect, as you can't
change an activity to a different driver once it has been created.</p>
<p>You can make use of more extensive Java or Javascript libraries as needed, mixing then with the
runtime controls provided above.</p>
<h2 id="enhanced-metrics-for-scripting">Enhanced Metrics for Scripting</h2>
<p>The metrics available in NoSQLBench are slightly different than the standard kit with dropwizard
metrics. The key differences are:</p>
<h3 id="hdr-histograms">HDR Histograms</h3>
<p>All histograms use HDR histograms with <em>four</em> significant digits.</p>
<p>All histograms reset on snapshot, automatically keeping all data until you report the snapshot or
access the snapshot via scripting. (see below).</p>
<p>The metric types that use histograms have been replaced with nicer version for scripting. You don't
have to do anything differently in your reporter config to use them. However, if you need to use the
enhanced versions in your local scripting, you can. This means that Timer and Histogram types are
enhanced. If you do not use the scripting extensions, then you will automatically get the standard
behavior that you are used to, only with higher-resolution HDR and full snapshots for each report to
your downstream metrics systems.</p>
<h3 id="scripting-with-delta-snapshots">Scripting with Delta Snapshots</h3>
<p>For both the timer and the histogram types, you can call getDeltaReader(), or access it simply as
&lt;metric&gt;.deltaReader. When you do this, the delta snapshotting behavior is maintained until
you use the deltaReader to access it. You can get a snapshot from the deltaReader by calling
getDeltaSnapshot(10000), which causes the snapshot to be reset for collection, but retains a cache
of the snapshot for any other consumer of getSnapshot() for that duration in milliseconds. If, for
example, metrics reporters access the snapshot in the next 10 seconds, the reported snapshot will be
exactly what was used in the script.</p>
<p>This is important for using local scripting methods and calculations with aggregate views
downstream. It means that the histograms will match up between your local script output and your
downstream dashboards, as they will both be using the same frame of data, when done properly.</p>
<h3 id="histogram-convenience-methods">Histogram Convenience Methods</h3>
<p>All histogram snapshots have additional convenience methods for accessing every percentile in (P50,
P75, P90, P95, P98, P99, P999, P9999) and every time unit in (s, ms, us, ns). For example,
getP99ms() is supported, as is getP50ns(), and every other possible combination. This means that you
can access the 99th percentile metric value in your scripts for activity <em>foo</em> as _
metrics.foo.cycles.snapshot.p99ms_.</p>
<h2 id="control-flow">Control Flow</h2>
<p>When a script is run, it has absolute control over the scenario runtime while it is active. Once the
script reaches its end, however, it will only exit if all activities have completed. If you want to
explicitly stop a script, you must stop all activities.</p>
<h2 id="strategies">Strategies</h2>
<p>You can use NoSQLBench in the classic form with <code>run driver=&lt;activity_type&gt; param=value ...</code> command
line syntax. There are reasons, however, that you will sometimes want to customize and modify your
scripts directly, such as:</p>
<ul>
<li>Permute test variables to cover many sub-conditions in a test.</li>
<li>Automatically adjust load factors to identify the nominal capacity of a system.</li>
<li>Adjust rate of a workload in order to get a specific measurement of system behavior.</li>
<li>React to changes in test or target system state in order to properly sequence a test.</li>
</ul>
<h2 id="script-input-output">Script Input &amp; Output</h2>
<p>Internal buffers are kept for <em>stdin</em>, <em>stdout</em>, and <em>stderr</em> for the scenario script execution.
These are logged to the logfile upon script completion, with markers showing the timestamp and file
descriptor (stdin, stdout, or stderr) that each line was recorded from.</p>

<p><b><a href="#">Back to top</a></b></p>
</article>
<div class="toc" aria-hidden="true">
  <div class="toc-sticky">
    <h5>Scripting Environment</h5>
    <div class="toc-item">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#dynamic-parameters">Dynamic Parameters</a>
    </div>
    <div class="toc-item">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#global-variables">Global Variables</a>
    </div>
    <div class="toc-item-child">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#scenario"><small>- scenario</small></a>
    </div>
    <div class="toc-item-child">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#activity-parameters"><small>- Activity Parameters</small></a>
    </div>
    <div class="toc-item">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#enhanced-metrics-for-scripting">Enhanced Metrics for Scripting</a>
    </div>
    <div class="toc-item-child">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#hdr-histograms"><small>- HDR Histograms</small></a>
    </div>
    <div class="toc-item-child">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#scripting-with-delta-snapshots"><small>- Scripting with Delta Snapshots</small></a>
    </div>
    <div class="toc-item-child">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#histogram-convenience-methods"><small>- Histogram Convenience Methods</small></a>
    </div>
    <div class="toc-item">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#control-flow">Control Flow</a>
    </div>
    <div class="toc-item">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#strategies">Strategies</a>
    </div>
    <div class="toc-item">
      <a class="subtext" href="https://docs.nosqlbench.io/user-guide/advanced-topics/scenario-scripting/scripting-environment/#script-input-output">Script Input &amp; Output</a>
    </div>
  </div>
</div>
  </main>
  <footer>
    <hr />
    <div class="c">
      <nav>
        <ul></ul>
      </nav>
      <p class="s90">Copyright &copy; 2023-2023 NoSQLBench Project</p>
    </div>
  </footer>
</body>
</html>
